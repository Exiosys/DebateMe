{"code":"// Shifts are encoded as negative state IDs, reduces as bitmasks with\n// the first 20 bits holding the term that's being reduced, and the\n// bits after that the number of values consumed.\nimport { parse } from \"./parse\";\nexport var REDUCE_DEPTH_SIZE = 6, REDUCE_DEPTH_MASK = Math.pow(2, REDUCE_DEPTH_SIZE) - 1;\nvar StringStream = /** @class */ (function () {\n    function StringStream(string) {\n        this.string = string;\n        this.pos = 0;\n    }\n    Object.defineProperty(StringStream.prototype, \"length\", {\n        get: function () { return this.string.length; },\n        enumerable: true,\n        configurable: true\n    });\n    StringStream.prototype.next = function () {\n        if (this.pos == this.string.length)\n            return -1;\n        return this.string.charCodeAt(this.pos);\n    };\n    StringStream.prototype.adv = function () { this.pos++; };\n    StringStream.prototype.goto = function (n) { this.pos = n; return this; };\n    StringStream.prototype.read = function (from, to) { return this.string.slice(from, to); };\n    return StringStream;\n}());\nexport { StringStream };\nexport function noToken(input) { return -1; }\nvar ParseState = /** @class */ (function () {\n    function ParseState(id, actions, goto, recover, alwaysReduce, defaultReduce, skip, tokenizers) {\n        this.id = id;\n        this.actions = actions;\n        this.goto = goto;\n        this.recover = recover;\n        this.alwaysReduce = alwaysReduce;\n        this.defaultReduce = defaultReduce;\n        this.skip = skip;\n        this.tokenizers = tokenizers;\n    }\n    ParseState.prototype.hasAction = function (terminal) { return lookup(this.actions, terminal) != 0; };\n    ParseState.prototype.anyReduce = function () {\n        if (this.alwaysReduce >= 0)\n            return this.alwaysReduce;\n        for (var i = 0; i < this.actions.length; i += 2) {\n            var action = this.actions[i + 1];\n            if (action > 0)\n                return action;\n        }\n        return 0;\n    };\n    // Zero means no entry found, otherwise it'll be a state id (never\n    // zero because no goto edges to the start state exist)\n    ParseState.prototype.getGoto = function (term) { return lookup(this.goto, term); };\n    ParseState.prototype.getRecover = function (terminal) { return lookup(this.recover, terminal); };\n    return ParseState;\n}());\nexport { ParseState };\nfunction lookup(actions, term) {\n    for (var i = 0; i < actions.length; i += 2)\n        if (actions[i] == term)\n            return actions[i + 1];\n    return 0;\n}\n// Odd numbers are anonymous terms. Even numbers have tags\nexport var ANON_TERM = 1;\nexport var TERM_ERR = 0, TERM_EOF = 1;\n// Repeat terms get assigned a high id so that they are easy to recognize\nexport var FIRST_REPEAT_TERM = Math.pow(2, 16) + 1;\nvar Parser = /** @class */ (function () {\n    function Parser(states, tags, repeats, specialized, specializations, termNames) {\n        if (termNames === void 0) { termNames = null; }\n        this.states = states;\n        this.tags = tags;\n        this.repeats = repeats;\n        this.specialized = specialized;\n        this.termNames = termNames;\n        this.specializations = specializations.map(withoutPrototype);\n    }\n    Parser.prototype.getTag = function (term) {\n        return (term & ANON_TERM) ? null : this.tags[term >> 1];\n    };\n    Parser.prototype.getName = function (term) {\n        return this.termNames ? this.termNames[term] : this.getTag(term) || String(term);\n    };\n    // Term should be a repeat term\n    Parser.prototype.getRepeat = function (term) {\n        return this.repeats[(term - FIRST_REPEAT_TERM) >> 1];\n    };\n    Parser.prototype.parse = function (input, options) {\n        return parse(input, this, options);\n    };\n    return Parser;\n}());\nexport { Parser };\nfunction withoutPrototype(obj) {\n    if (!(obj instanceof Object))\n        return obj;\n    var result = Object.create(null);\n    for (var prop in obj)\n        if (Object.prototype.hasOwnProperty.call(obj, prop))\n            result[prop] = obj[prop];\n    return result;\n}\nvar none = [];\nexport function s(actions, goto, defaultReduce, skip, tokenizers, recover) {\n    return new ParseState(s.id++, typeof actions == \"number\" ? none : actions, goto, recover || none, typeof actions == \"number\" ? actions : -1, defaultReduce, skip, tokenizers);\n}\ns.id = 0;\n//# sourceMappingURL=parser.js.map","map":"{\"version\":3,\"file\":\"parser.js\",\"sourceRoot\":\"\",\"sources\":[\"../../src/parser.ts\"],\"names\":[],\"mappings\":\"AAAA,qEAAqE;AACrE,mEAAmE;AACnE,iDAAiD;AAEjD,OAAO,EAAC,KAAK,EAAC,MAAM,SAAS,CAAA;AAG7B,MAAM,CAAC,IAAM,iBAAiB,GAAG,CAAC,EAAE,iBAAiB,GAAG,SAAA,CAAC,EAAE,iBAAiB,CAAA,GAAG,CAAC,CAAA;AAWhF;IAGE,sBAAqB,MAAc;QAAd,WAAM,GAAN,MAAM,CAAQ;QAFnC,QAAG,GAAG,CAAC,CAAA;IAE+B,CAAC;IAEvC,sBAAI,gCAAM;aAAV,cAAe,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,CAAA,CAAC,CAAC;;;OAAA;IAE1C,2BAAI,GAAJ;QACE,IAAI,IAAI,CAAC,GAAG,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM;YAAE,OAAO,CAAC,CAAC,CAAA;QAC7C,OAAO,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;IACzC,CAAC;IAED,0BAAG,GAAH,cAAQ,IAAI,CAAC,GAAG,EAAE,CAAA,CAAC,CAAC;IAEpB,2BAAI,GAAJ,UAAK,CAAS,IAAI,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,OAAO,IAAI,CAAA,CAAC,CAAC;IAE7C,2BAAI,GAAJ,UAAK,IAAY,EAAE,EAAU,IAAY,OAAO,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,EAAE,EAAE,CAAC,CAAA,CAAC,CAAC;IAC/E,mBAAC;AAAD,CAAC,AAjBD,IAiBC;;AAID,MAAM,UAAU,OAAO,CAAC,KAAkB,IAAI,OAAO,CAAC,CAAC,CAAA,CAAC,CAAC;AAEzD;IACE,oBAAqB,EAAU,EACV,OAA8B,EAC9B,IAA2B,EAC3B,OAA8B,EAC9B,YAAoB,EACpB,aAAqB,EACrB,IAAe,EACf,UAAoC;QAPpC,OAAE,GAAF,EAAE,CAAQ;QACV,YAAO,GAAP,OAAO,CAAuB;QAC9B,SAAI,GAAJ,IAAI,CAAuB;QAC3B,YAAO,GAAP,OAAO,CAAuB;QAC9B,iBAAY,GAAZ,YAAY,CAAQ;QACpB,kBAAa,GAAb,aAAa,CAAQ;QACrB,SAAI,GAAJ,IAAI,CAAW;QACf,eAAU,GAAV,UAAU,CAA0B;IAAG,CAAC;IAE7D,8BAAS,GAAT,UAAU,QAAgB,IAAI,OAAO,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAA,CAAC,CAAC;IAE1E,8BAAS,GAAT;QACE,IAAI,IAAI,CAAC,YAAY,IAAI,CAAC;YAAE,OAAO,IAAI,CAAC,YAAY,CAAA;QACpD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,EAAE;YAC/C,IAAI,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,CAAC,CAAA;YAChC,IAAI,MAAM,GAAG,CAAC;gBAAE,OAAO,MAAM,CAAA;SAC9B;QACD,OAAO,CAAC,CAAA;IACV,CAAC;IACD,kEAAkE;IAClE,uDAAuD;IACvD,4BAAO,GAAP,UAAQ,IAAY,IAAI,OAAO,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAA,CAAC,CAAC;IACxD,+BAAU,GAAV,UAAW,QAAgB,IAAI,OAAO,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAA,CAAC,CAAC;IACxE,iBAAC;AAAD,CAAC,AAxBD,IAwBC;;AAED,SAAS,MAAM,CAAC,OAA8B,EAAE,IAAY;IAC1D,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,IAAG,CAAC;QAAE,IAAI,OAAO,CAAC,CAAC,CAAC,IAAI,IAAI;YAAE,OAAO,OAAO,CAAC,CAAC,GAAG,CAAC,CAAC,CAAA;IACxF,OAAO,CAAC,CAAA;AACV,CAAC;AAED,0DAA0D;AAC1D,MAAM,CAAC,IAAM,SAAS,GAAG,CAAC,CAAA;AAE1B,MAAM,CAAC,IAAM,QAAQ,GAAG,CAAC,EAAE,QAAQ,GAAG,CAAC,CAAA;AAEvC,yEAAyE;AACzE,MAAM,CAAC,IAAM,iBAAiB,GAAG,SAAA,CAAC,EAAE,EAAE,CAAA,GAAG,CAAC,CAAA;AAI1C;IAGE,gBAAqB,MAAiC,EACjC,IAA2B,EAC3B,OAA8B,EAC9B,WAAkC,EAC3C,eAAyD,EAChD,SAA+C;QAA/C,0BAAA,EAAA,gBAA+C;QAL/C,WAAM,GAAN,MAAM,CAA2B;QACjC,SAAI,GAAJ,IAAI,CAAuB;QAC3B,YAAO,GAAP,OAAO,CAAuB;QAC9B,gBAAW,GAAX,WAAW,CAAuB;QAElC,cAAS,GAAT,SAAS,CAAsC;QAClE,IAAI,CAAC,eAAe,GAAG,eAAe,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAA;IAC9D,CAAC;IAED,uBAAM,GAAN,UAAO,IAAY;QACjB,OAAO,CAAC,IAAI,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,CAAC,CAAA;IACzD,CAAC;IAED,wBAAO,GAAP,UAAQ,IAAY;QAClB,OAAO,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,MAAM,CAAC,IAAI,CAAC,CAAA;IAClF,CAAC;IAED,+BAA+B;IAC/B,0BAAS,GAAT,UAAU,IAAY;QACpB,OAAO,IAAI,CAAC,OAAO,CAAC,CAAC,IAAI,GAAG,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAA;IACtD,CAAC;IAED,sBAAK,GAAL,UAAM,KAAkB,EAAE,OAAsB;QAC9C,OAAO,KAAK,CAAC,KAAK,EAAE,IAAI,EAAE,OAAO,CAAC,CAAA;IACpC,CAAC;IACH,aAAC;AAAD,CAAC,AA5BD,IA4BC;;AAED,SAAS,gBAAgB,CAAC,GAAO;IAC/B,IAAI,CAAC,CAAC,GAAG,YAAY,MAAM,CAAC;QAAE,OAAO,GAAG,CAAA;IACxC,IAAI,MAAM,GAAyB,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;IACtD,KAAK,IAAI,IAAI,IAAI,GAAG;QAAE,IAAI,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC;YAAE,MAAM,CAAC,IAAI,CAAC,GAAI,GAAW,CAAC,IAAI,CAAC,CAAA;IAC5G,OAAO,MAAM,CAAA;AACf,CAAC;AAED,IAAM,IAAI,GAAuB,EAAE,CAAA;AAEnC,MAAM,UAAU,CAAC,CAAC,OAAuC,EACvC,IAA2B,EAC3B,aAAqB,EACrB,IAAe,EACf,UAAoC,EACpC,OAA+B;IAC/C,OAAO,IAAI,UAAU,CAAC,CAAC,CAAC,EAAE,EAAE,EAAE,OAAO,OAAO,IAAI,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO,EACnD,IAAI,EAAE,OAAO,IAAI,IAAI,EAAE,OAAO,OAAO,IAAI,QAAQ,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,EAChE,aAAa,EAAE,IAAI,EAAE,UAAU,CAAC,CAAA;AACxD,CAAC;AAED,CAAC,CAAC,EAAE,GAAG,CAAC,CAAA\"}"}
