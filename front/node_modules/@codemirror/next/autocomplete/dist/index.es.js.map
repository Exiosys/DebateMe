{"version":3,"file":"index.es.js","sources":["../src/index.ts"],"sourcesContent":["import {ViewPlugin, PluginValue, ViewUpdate, EditorView} from \"../../view\"\nimport {combineConfig, Annotation, EditorSelection, EditorState,\n        Transaction, Extension, StateField, Facet, Precedence} from \"../../state\"\nimport {keymap} from \"../../keymap\"\nimport {Tooltip, tooltips, showTooltip} from \"../../tooltip\"\n\nexport interface AutocompleteData {\n  completeAt: (state: EditorState, pos: number) => CompletionResult | Promise<CompletionResult>\n}\n\nexport interface CompletionResult {\n  items: readonly Completion[]\n}\n\nexport interface Completion {\n  label: string,\n  start: number,\n  end: number,\n  apply?: string | ((view: EditorView) => void)\n}\n\nexport function completeFromSyntax(state: EditorState, pos: number): CompletionResult | Promise<CompletionResult> {\n  let syntax = state.facet(EditorState.syntax)\n  if (syntax.length == 0) return {items: []}\n  let {completeAt} = syntax[0].languageDataAt<AutocompleteData>(state, pos)\n  return completeAt ? completeAt(state, pos) : {items: []}\n}\n\nexport function sortAndFilterCompletion(substr: string, items: ReadonlyArray<Completion>) {\n  const startMatch = [], inMatch = []\n  for (const item of items) {\n    if (item.label == substr) continue\n    // FIXME: separate key\n    else if (item.label.startsWith(substr)) startMatch.push(item)\n    else if (item.label.includes(substr)) inMatch.push(item)\n  }\n  return startMatch.concat(inMatch)\n}\n\nconst autocompleteConfig = Facet.define<Partial<AutocompleteData>, AutocompleteData>({\n  combine(configs) {\n    return combineConfig(configs, {\n      completeAt(state: EditorState, pos: number) {\n        return completeFromSyntax(state, pos) || {start: pos, items: []}\n      }\n    })\n  }\n})\n\nexport function autocomplete(config: Partial<AutocompleteData> = {}): Extension {\n  return [\n    activeCompletion,\n    autocompleteConfig.of(config),\n    autocompletePlugin,\n    Precedence.Fallback.set(style),\n    tooltips(),\n    Precedence.Override.set(keymap({\n      ArrowDown: moveCompletion(\"down\"),\n      ArrowUp: moveCompletion(\"up\"),\n      Enter: acceptCompletion,\n      Escape: closeCompletion\n    }))\n  ]\n}\n\nfunction moveCompletion(dir: string) {\n  return (view: EditorView) => {\n    let active = view.state.field(activeCompletion)\n    if (!(active instanceof ActiveCompletion)) return false\n    let selected = (active.selected + (dir == \"up\" ? active.options.length - 1 : 1)) % active.options.length\n    view.dispatch(view.state.t().annotate(setActiveCompletion, new ActiveCompletion(active.options, selected, active.tooltip)))\n    return true\n  }\n}\n\nfunction acceptCompletion(view: EditorView) {\n  let active = view.state.field(activeCompletion)\n  if (!(active instanceof ActiveCompletion)) return false\n  applyCompletion(view, active.options[active.selected])\n  return true\n}\n\nexport function startCompletion(view: EditorView) {\n  let active = view.state.field(activeCompletion)\n  if (active != null) return false\n  view.dispatch(view.state.t().annotate(setActiveCompletion, \"pending\"))\n  return true\n}\n\nfunction applyCompletion(view: EditorView, option: Completion) {\n  let apply = option.apply || option.label\n  // FIXME make sure option.start/end still point at the current\n  // doc, or keep a mapping in an active completion\n  if (typeof apply == \"string\") {\n    view.dispatch(view.state.t().replace(option.start, option.end, apply)\n                  .setSelection(EditorSelection.single(option.start + apply.length)))\n  } else {\n    apply(view)\n  }\n}\n\nfunction closeCompletion(view: EditorView) {\n  let active = view.state.field(activeCompletion)\n  if (active == null) return false\n  view.dispatch(view.state.t().annotate(setActiveCompletion, null))\n  return true\n}\n\nconst setActiveCompletion = Annotation.define<ActiveCompletion | null | \"pending\">()\n\nconst activeCompletion = StateField.define<ActiveCompletion | null | \"pending\">({\n  create() { return null },\n  update(prev, tr) {\n    let set = tr.annotation(setActiveCompletion)\n    if (set !== undefined) return set\n\n    return tr.annotation(Transaction.userEvent) == \"input\" ? \"pending\"\n      : tr.docChanged || tr.selectionSet ? null\n      : prev\n  }\n}).provideN(showTooltip, active => active instanceof ActiveCompletion ? [active.tooltip] : [])\n\nclass ActiveCompletion {\n  constructor(readonly options: readonly Completion[],\n              readonly selected: number,\n              readonly tooltip: (view: EditorView) => Tooltip) {}\n}\n\nfunction createListBox(options: readonly Completion[]) {\n  const ul = document.createElement(\"ul\")\n  ul.setAttribute(\"role\", \"listbox\") // FIXME this won't be focused, so the aria attributes aren't really useful\n  for (let option of options) {\n    const li = ul.appendChild(document.createElement(\"li\"))\n    li.innerText = option.label\n    li.setAttribute(\"role\", \"option\")\n  }\n  return ul\n}\n\nfunction buildTooltip(options: readonly Completion[]) {\n  return (view: EditorView): Tooltip => {\n    let list = createListBox(options)\n    list.addEventListener(\"click\", (e: MouseEvent) => {\n      let index = 0, dom = e.target as HTMLElement | null\n      for (;;) { dom = dom!.previousSibling as (HTMLElement | null); if (!dom) break; index++ }\n      let active = view.state.field(activeCompletion)\n      if (active instanceof ActiveCompletion && index < active.options.length)\n        applyCompletion(view, active.options[index])\n    })\n    function updateSel(view: EditorView) {\n      let cur = view.state.field(activeCompletion)\n      if (cur instanceof ActiveCompletion) updateSelectedOption(list, cur.selected)\n    }\n    return {\n      dom: list,\n      mount: updateSel,\n      update(update: ViewUpdate) {\n        if (update.state.field(activeCompletion) != update.prevState.field(activeCompletion)) updateSel(update.view)\n      },\n      pos: options.reduce((m, o) => Math.min(m, o.start), 1e9),\n      style: \"autocomplete\"\n    }\n  }\n}\n\nfunction updateSelectedOption(list: HTMLElement, selected: number) {\n  let set: null | HTMLElement = null\n  for (let opt = list.firstChild as (HTMLElement | null), i = 0; opt;\n       opt = opt.nextSibling as (HTMLElement | null), i++) {\n    if (i == selected) {\n      if (!opt.hasAttribute(\"aria-selected\")) {\n        opt.setAttribute(\"aria-selected\", \"true\")\n        set = opt\n      }\n    } else {\n      if (opt.hasAttribute(\"aria-selected\")) opt.removeAttribute(\"aria-selected\")\n    }\n  }\n  if (set) scrollIntoView(list, set)\n}\n\nfunction scrollIntoView(container: HTMLElement, element: HTMLElement) {\n  let parent = container.getBoundingClientRect()\n  let self = element.getBoundingClientRect()\n  if (self.top < parent.top) container.scrollTop -= parent.top - self.top\n  else if (self.bottom > parent.bottom) container.scrollTop += self.bottom - parent.bottom\n}\n\nconst DebounceTime = 100\n\nconst autocompletePlugin = ViewPlugin.fromClass(class implements PluginValue {\n  stateVersion = 0\n  debounce = -1\n\n  constructor(readonly view: EditorView) {}\n\n  update(update: ViewUpdate) {\n    if (!(update.docChanged || update.selectionSet ||\n          update.transactions.some(t => t.annotation(setActiveCompletion) !== undefined))) return\n    this.stateVersion++\n    if (this.debounce > -1) clearTimeout(this.debounce)\n    let active = update.state.field(activeCompletion)\n    this.debounce = active == \"pending\" ? setTimeout(() => this.startUpdate(), DebounceTime) : -1\n  }\n\n  startUpdate() {\n    this.debounce = -1\n    let version = this.stateVersion, state = this.view.state\n    let config = state.facet(autocompleteConfig)\n    Promise.resolve(config.completeAt(state, state.selection.primary.head)).then(result => {\n      if (this.stateVersion != version || result.items.length == 0) return\n      let tooltip = buildTooltip(result.items)\n      this.view.dispatch(this.view.state.t().annotate(setActiveCompletion, new ActiveCompletion(result.items, 0, tooltip)))\n    })\n  }\n})\n\nconst style = EditorView.theme({\n  \"tooltip.autocomplete\": {\n    fontFamily: \"monospace\",\n    overflowY: \"auto\",\n    maxHeight: \"10em\",\n    listStyle: \"none\",\n    margin: 0,\n    padding: 0,\n\n    \"& > li\": {\n      cursor: \"pointer\",\n      padding: \"1px 1em 1px 3px\"\n    },\n\n    \"& > li[aria-selected]\": {\n      background_fallback: \"#bdf\",\n      background: \"Highlight\",\n      color_fallback: \"white\",\n      color: \"HighlightText\"\n    }\n  }\n})\n"],"names":[],"mappings":"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"}