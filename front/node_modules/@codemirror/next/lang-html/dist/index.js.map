{"version":3,"file":"index.js","sources":["../src/html.ts"],"sourcesContent":["import {configureHTML} from \"lezer-html\"\nimport {cssSyntax} from \"../../lang-css\"\nimport {javascriptSyntax} from \"../../lang-javascript\"\nimport {LezerSyntax, delimitedIndent, continuedIndent, indentNodeProp, foldNodeProp, openNodeProp, closeNodeProp} from \"../../syntax\"\nimport {Subtree} from \"lezer-tree\"\nimport {styleTags} from \"../../highlight\"\n\n/// A syntax provider based on the [Lezer HTML\n/// parser](https://github.com/lezer-parser/html), wired up with the\n/// JavaScript and CSS parsers to parse the content of `<script>` and\n/// `<style>` tags.\nexport const htmlSyntax = new LezerSyntax(configureHTML([\n  {tag: \"script\",\n   attrs(attrs) {\n     return !attrs.type || /^(?:text|application)\\/(?:x-)?(?:java|ecma)script$|^module$|^$/i.test(attrs.type)\n   },\n   parser: javascriptSyntax.parser},\n  {tag: \"style\",\n   attrs(attrs) {\n     return (!attrs.lang || attrs.lang == \"css\") && (!attrs.type || /^(text\\/)?(x-)?(stylesheet|css)$/i.test(attrs.type))\n   },\n   parser: cssSyntax.parser}\n]).withProps(\n  indentNodeProp.add(type => {\n    if (type.name == \"Element\") return delimitedIndent({closing: \"</\", align: false})\n    if (type.name == \"OpenTag\" || type.name == \"CloseTag\" || type.name == \"SelfClosingTag\") return continuedIndent()\n    return undefined\n  }),\n  foldNodeProp.add({\n    Element(subtree: Subtree) {\n      let first = subtree.firstChild, last = subtree.lastChild!\n      if (!first || first.name != \"OpenTag\") return null\n      return {from: first.end, to: last.name == \"CloseTag\" ? last.start : subtree.end}\n    }\n  }),\n  openNodeProp.add({\n    \"StartTag StartCloseTag\": [\"EndTag\", \"SelfCloseEndTag\"],\n    \"OpenTag\": [\"CloseTag\"]\n  }),\n  closeNodeProp.add({\n    \"EndTag SelfCloseEndTag\": [\"StartTag\", \"StartCloseTag\"],\n    \"CloseTag\": [\"OpenTag\"]\n  }),\n  styleTags({\n    AttributeValue: \"string\",\n    \"Text RawText\": \"content\",\n    \"StartTag StartCloseTag SelfCloserEndTag EndTag SelfCloseEndTag\": \"angleBracket\",\n    TagName: \"typeName\",\n    MismatchedTagName: \"typeName invalid\",\n    AttributeName: \"propertyName\",\n    UnquotedAttributeValue: \"string\",\n    Is: \"operator definition\",\n    \"EntityReference CharacterReference\": \"character\",\n    Comment: \"blockComment\",\n    ProcessingInst: \"operator meta\",\n    DoctypeDecl: \"labelName meta\"\n  })\n))\n\n/// Returns an extension that installs the HTML syntax provider.\nexport function html() { return htmlSyntax.extension }\n"],"names":["LezerSyntax","configureHTML","javascriptSyntax","cssSyntax","indentNodeProp","delimitedIndent","continuedIndent","foldNodeProp","openNodeProp","closeNodeProp","styleTags"],"mappings":";;;;;;;;;;AAOA;;;;AAIA,MAAa,UAAU,GAAG,IAAIA,kBAAW,CAACC,uBAAa,CAAC;IACtD,EAAC,GAAG,EAAE,QAAQ;QACb,KAAK,CAAC,KAAK;YACT,OAAO,CAAC,KAAK,CAAC,IAAI,IAAI,iEAAiE,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;SACzG;QACD,MAAM,EAAEC,+BAAgB,CAAC,MAAM,EAAC;IACjC,EAAC,GAAG,EAAE,OAAO;QACZ,KAAK,CAAC,KAAK;YACT,OAAO,CAAC,CAAC,KAAK,CAAC,IAAI,IAAI,KAAK,CAAC,IAAI,IAAI,KAAK,MAAM,CAAC,KAAK,CAAC,IAAI,IAAI,mCAAmC,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAA;SACrH;QACD,MAAM,EAAEC,iBAAS,CAAC,MAAM,EAAC;CAC3B,CAAC,CAAC,SAAS,CACVC,qBAAc,CAAC,GAAG,CAAC,IAAI;IACrB,IAAI,IAAI,CAAC,IAAI,IAAI,SAAS;QAAE,OAAOC,sBAAe,CAAC,EAAC,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAC,CAAC,CAAA;IACjF,IAAI,IAAI,CAAC,IAAI,IAAI,SAAS,IAAI,IAAI,CAAC,IAAI,IAAI,UAAU,IAAI,IAAI,CAAC,IAAI,IAAI,gBAAgB;QAAE,OAAOC,sBAAe,EAAE,CAAA;IAChH,OAAO,SAAS,CAAA;CACjB,CAAC,EACFC,mBAAY,CAAC,GAAG,CAAC;IACf,OAAO,CAAC,OAAgB;QACtB,IAAI,KAAK,GAAG,OAAO,CAAC,UAAU,EAAE,IAAI,GAAG,OAAO,CAAC,SAAU,CAAA;QACzD,IAAI,CAAC,KAAK,IAAI,KAAK,CAAC,IAAI,IAAI,SAAS;YAAE,OAAO,IAAI,CAAA;QAClD,OAAO,EAAC,IAAI,EAAE,KAAK,CAAC,GAAG,EAAE,EAAE,EAAE,IAAI,CAAC,IAAI,IAAI,UAAU,GAAG,IAAI,CAAC,KAAK,GAAG,OAAO,CAAC,GAAG,EAAC,CAAA;KACjF;CACF,CAAC,EACFC,mBAAY,CAAC,GAAG,CAAC;IACf,wBAAwB,EAAE,CAAC,QAAQ,EAAE,iBAAiB,CAAC;IACvD,SAAS,EAAE,CAAC,UAAU,CAAC;CACxB,CAAC,EACFC,oBAAa,CAAC,GAAG,CAAC;IAChB,wBAAwB,EAAE,CAAC,UAAU,EAAE,eAAe,CAAC;IACvD,UAAU,EAAE,CAAC,SAAS,CAAC;CACxB,CAAC,EACFC,mBAAS,CAAC;IACR,cAAc,EAAE,QAAQ;IACxB,cAAc,EAAE,SAAS;IACzB,gEAAgE,EAAE,cAAc;IAChF,OAAO,EAAE,UAAU;IACnB,iBAAiB,EAAE,kBAAkB;IACrC,aAAa,EAAE,cAAc;IAC7B,sBAAsB,EAAE,QAAQ;IAChC,EAAE,EAAE,qBAAqB;IACzB,oCAAoC,EAAE,WAAW;IACjD,OAAO,EAAE,cAAc;IACvB,cAAc,EAAE,eAAe;IAC/B,WAAW,EAAE,gBAAgB;CAC9B,CAAC,CACH,CAAC,CAAA;;AAGF,SAAgB,IAAI,KAAK,OAAO,UAAU,CAAC,SAAS,CAAA,EAAE;;;;;"}