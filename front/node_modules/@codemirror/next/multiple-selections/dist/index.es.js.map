{"version":3,"file":"index.es.js","sources":["../src/multiple-selections.ts"],"sourcesContent":["import {EditorState, StateField, EditorSelection, Extension} from \"../../state\"\nimport {DecorationSet, Decoration, WidgetType, EditorView, themeClass} from \"../../view\"\n\nconst field = StateField.define<DecorationSet>({\n  create(state) {\n    return decorateSelections(state.selection)\n  },\n  update(deco, tr) {\n    return tr.docChanged || tr.selectionSet ? decorateSelections(tr.selection) : deco\n  }\n}).provide(EditorView.decorations)\n\n/// Returns an extension that enables multiple selections for the\n/// editor. Secondary cursors and selected ranges are drawn with\n/// simple decorations, and might not look the same as the primary\n/// native selection.\nexport function multipleSelections(): Extension {\n  return [\n    EditorState.allowMultipleSelections.of(true),\n    field,\n    styles\n  ]\n}\n\nclass CursorWidget extends WidgetType<null> {\n  toDOM() {\n    let span = document.createElement(\"span\")\n    span.className = themeClass(\"secondaryCursor\")\n    return span\n  }\n\n  static deco = Decoration.widget({widget: new CursorWidget(null)})\n}\n\nconst rangeMark = Decoration.mark({class: themeClass(\"secondarySelection\")})\n\nfunction decorateSelections(selection: EditorSelection): DecorationSet {\n  let {ranges, primaryIndex} = selection\n  if (ranges.length == 1) return Decoration.none\n  let deco = []\n  for (let i = 0; i < ranges.length; i++) if (i != primaryIndex) {\n    let range = ranges[i]\n    deco.push(range.empty ? CursorWidget.deco.range(range.from) : rangeMark.range(ranges[i].from, ranges[i].to))\n  }\n  return Decoration.set(deco)\n}\n\nconst styles = EditorView.baseTheme({\n  secondarySelection: {\n    backgroundColor_fallback: \"#3297FD\",\n    color_fallback: \"white !important\",\n    backgroundColor: \"Highlight\",\n    color: \"HighlightText !important\"\n  },\n\n  secondaryCursor: {\n    display: \"inline-block\",\n    verticalAlign: \"text-top\",\n    borderLeft: \"1.4px solid #555\",\n    width: 0,\n    height: \"1.15em\",\n    margin: \"0 -0.7px -.7em\"\n  }\n})\n"],"names":[],"mappings":";;;AAGA,MAAM,KAAK,GAAG,UAAU,CAAC,MAAM,CAAgB;IAC7C,MAAM,CAAC,KAAK;QACV,OAAO,kBAAkB,CAAC,KAAK,CAAC,SAAS,CAAC,CAAA;KAC3C;IACD,MAAM,CAAC,IAAI,EAAE,EAAE;QACb,OAAO,EAAE,CAAC,UAAU,IAAI,EAAE,CAAC,YAAY,GAAG,kBAAkB,CAAC,EAAE,CAAC,SAAS,CAAC,GAAG,IAAI,CAAA;KAClF;CACF,CAAC,CAAC,OAAO,CAAC,UAAU,CAAC,WAAW,CAAC,CAAA;;;;;AAMlC,SAAgB,kBAAkB;IAChC,OAAO;QACL,WAAW,CAAC,uBAAuB,CAAC,EAAE,CAAC,IAAI,CAAC;QAC5C,KAAK;QACL,MAAM;KACP,CAAA;CACF;AAED,MAAM,YAAa,SAAQ,UAAgB;IACzC,KAAK;QACH,IAAI,IAAI,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAA;QACzC,IAAI,CAAC,SAAS,GAAG,UAAU,CAAC,iBAAiB,CAAC,CAAA;QAC9C,OAAO,IAAI,CAAA;KACZ;;AAEM,iBAAI,GAAG,UAAU,CAAC,MAAM,CAAC,EAAC,MAAM,EAAE,IAAI,YAAY,CAAC,IAAI,CAAC,EAAC,CAAC,CAAA;AAGnE,MAAM,SAAS,GAAG,UAAU,CAAC,IAAI,CAAC,EAAC,KAAK,EAAE,UAAU,CAAC,oBAAoB,CAAC,EAAC,CAAC,CAAA;AAE5E,SAAS,kBAAkB,CAAC,SAA0B;IACpD,IAAI,EAAC,MAAM,EAAE,YAAY,EAAC,GAAG,SAAS,CAAA;IACtC,IAAI,MAAM,CAAC,MAAM,IAAI,CAAC;QAAE,OAAO,UAAU,CAAC,IAAI,CAAA;IAC9C,IAAI,IAAI,GAAG,EAAE,CAAA;IACb,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE;QAAE,IAAI,CAAC,IAAI,YAAY,EAAE;YAC7D,IAAI,KAAK,GAAG,MAAM,CAAC,CAAC,CAAC,CAAA;YACrB,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,YAAY,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,SAAS,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;SAC7G;IACD,OAAO,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;CAC5B;AAED,MAAM,MAAM,GAAG,UAAU,CAAC,SAAS,CAAC;IAClC,kBAAkB,EAAE;QAClB,wBAAwB,EAAE,SAAS;QACnC,cAAc,EAAE,kBAAkB;QAClC,eAAe,EAAE,WAAW;QAC5B,KAAK,EAAE,0BAA0B;KAClC;IAED,eAAe,EAAE;QACf,OAAO,EAAE,cAAc;QACvB,aAAa,EAAE,UAAU;QACzB,UAAU,EAAE,kBAAkB;QAC9B,KAAK,EAAE,CAAC;QACR,MAAM,EAAE,QAAQ;QAChB,MAAM,EAAE,gBAAgB;KACzB;CACF,CAAC,CAAA;;;;"}