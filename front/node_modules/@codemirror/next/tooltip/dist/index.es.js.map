{"version":3,"file":"index.es.js","sources":["../src/tooltip.ts"],"sourcesContent":["import {EditorView, ViewPlugin, ViewUpdate, themeClass} from \"../../view\"\nimport {Annotation, Facet, StateField, Extension} from \"../../state\"\n\nconst HoverTime = 750, HoverMaxDist = 10\n\ntype Rect = {left: number, right: number, top: number, bottom: number}\n\ntype Measured = {\n  editor: Rect,\n  pos: (Rect | null)[],\n  size: Rect[],\n  innerWidth: number,\n  innerHeight: number\n}\n\nconst tooltipPlugin = ViewPlugin.fromClass(class {\n  sources: readonly ((view: EditorView) => Tooltip)[]\n  tooltips: Tooltip[]\n  measureReq: {read: () => Measured, write: (m: Measured) => void, key: any}\n\n  constructor(readonly view: EditorView) {\n    view.scrollDOM.addEventListener(\"scroll\", this.onscroll = this.onscroll.bind(this))\n    this.measureReq = {read: this.readMeasure.bind(this), write: this.writeMeasure.bind(this), key: this}\n    this.sources = view.state.facet(showTooltip)\n    this.tooltips = this.sources.map(s => this.createTooltip(s))\n  }\n\n  update(update: ViewUpdate) {\n    let sources = update.state.facet(showTooltip)\n    if (sources == this.sources) {\n      for (let t of this.tooltips) if (t.update) t.update(update)\n    } else {\n      let tooltips = []\n      for (let i = 0; i < sources.length; i++) {\n        let source = sources[i], known = this.sources.indexOf(source)\n        if (known < 0) {\n          tooltips[i] = this.createTooltip(source)\n        } else {\n          let tooltip = tooltips[i] = this.tooltips[known]\n          if (tooltip.update) tooltip.update(update)\n        }\n      }\n      for (let t of this.tooltips) if (tooltips.indexOf(t) < 0) t.dom.remove()\n      this.sources = sources\n      this.tooltips = tooltips\n      if (this.tooltips.length) this.view.requestMeasure(this.measureReq)\n    }\n\n    if (update.docChanged && this.tooltips.length) this.view.requestMeasure(this.measureReq)\n  }\n\n  createTooltip(source: (view: EditorView) => Tooltip) {\n    let tooltip = source(this.view)\n    tooltip.dom.className = themeClass(\"tooltip\" + (tooltip.style ? \".\" + tooltip.style : \"\"))\n    this.view.dom.appendChild(tooltip.dom)\n    if (tooltip.mount) tooltip.mount(this.view)\n    return tooltip\n  }\n\n  destroy() {\n    this.view.scrollDOM.removeEventListener(\"scroll\", this.onscroll)\n    for (let {dom} of this.tooltips) dom.remove()\n  }\n\n  readMeasure() {\n    return {\n      editor: this.view.dom.getBoundingClientRect(),\n      pos: this.tooltips.map(tooltip => this.view.coordsAtPos(tooltip.pos)),\n      size: this.tooltips.map(({dom}) => dom.getBoundingClientRect()),\n      innerWidth: window.innerWidth,\n      innerHeight: window.innerHeight\n    }\n  }\n\n  writeMeasure(measured: Measured) {\n    let {editor} = measured\n    for (let i = 0; i < this.tooltips.length; i++) {\n      let tooltip = this.tooltips[i], pos = measured.pos[i], size = measured.size[i]\n      // Hide tooltips that are outside of the editor.\n      if (!pos || pos.bottom <= editor.top || pos.top >= editor.bottom || pos.right <= editor.left || pos.left >= editor.right) {\n        tooltip.dom.style.top = \"-10000px\"\n        continue\n      }\n      let width = size.right - size.left, height = size.bottom - size.top\n      let align = pos.left + width < measured.innerWidth\n      let above = !!tooltip.above\n      if (!tooltip.strictSide &&\n          (above ? pos.top - (size.bottom - size.top) < 0 : pos.bottom + (size.bottom - size.top) > measured.innerHeight))\n        above = !above\n      tooltip.dom.style.left = ((align ? pos.left : measured.innerWidth - width) - editor.left) + \"px\"\n      tooltip.dom.style.top = ((above ? pos.top - height : pos.bottom) - editor.top) + \"px\"\n    }\n  }\n\n  onscroll() {\n    if (this.tooltips.length) this.view.requestMeasure(this.measureReq)\n  }\n})\n\nconst baseTheme = EditorView.baseTheme({\n  tooltip: {\n    position: \"absolute\",\n    border: \"1px solid silver\",\n    background: \"#f5f5f5\",\n    zIndex: 100\n  }\n})\n\n/// Supporting extension for displaying tooltips. Allows\n/// [`showTooltip`](#tooltip.showTooltip) to be used to define\n/// tooltips.\nexport function tooltips(): Extension {\n  return [tooltipPlugin, baseTheme]\n}\n\n/// Describes a tooltip.\nexport interface Tooltip {\n  /// The DOM element to position over the editor.\n  dom: HTMLElement\n  /// Called after the tooltip is added to the DOM for the first time.\n  mount?(view: EditorView): void\n  /// Update the DOM element for a change in the view's state.\n  update?(update: ViewUpdate): void\n  /// The document position at which to show the tooltip.\n  pos: number\n  /// An extra theme selector to use for the tooltip. By default,\n  /// it'll be themed as `\"tooltip\"`, but you can pass a name, say\n  /// `\"mine\"`, to style it as `\"tooltip.mine\"` instead.\n  style?: string\n  /// Whether the tooltip should be shown above or below the target\n  /// position. Defaults to false.\n  above?: boolean\n  /// Whether the `above` option should be honored when there isn't\n  /// enough space on that side to show the tooltip inside the\n  /// viewport. Defaults to false.\n  strictSide?: boolean\n}\n\n/// Behavior by which an extension can provide a tooltip to be shown.\nexport const showTooltip = Facet.define<(view: EditorView) => Tooltip>()\n\n/// Hover tooltips are associated with a range, rather than a single\n/// position.\nexport interface HoverTooltip {\n  /// The start of the target range.\n  start: number\n  /// The end of the target range. The tooltip will be hidden when the\n  /// pointer is no longer over this range.\n  end: number\n  /// The tooltip constructor.\n  tooltip: (view: EditorView) => Tooltip,\n}\n\nclass HoverPlugin {\n  lastMouseMove: MouseEvent | null = null\n  hoverTimeout = -1\n  mouseInside = false\n\n  constructor(readonly view: EditorView,\n              readonly source: (view: EditorView, check: (from: number, to: number) => boolean) => HoverTooltip | null,\n              readonly field: StateField<HoverTooltip | null>,\n              readonly setHover: Annotation<HoverTooltip | null>) {\n    this.checkHover = this.checkHover.bind(this)\n    view.dom.addEventListener(\"mouseenter\", this.mouseenter = this.mouseenter.bind(this))\n    view.dom.addEventListener(\"mouseleave\", this.mouseleave = this.mouseleave.bind(this))\n    view.dom.addEventListener(\"mousemove\", this.mousemove = this.mousemove.bind(this))\n  }\n\n  get active() { return this.view.state.field(this.field) }\n\n  checkHover() {\n    this.hoverTimeout = -1\n    if (!this.mouseInside || this.active) return\n    let now = Date.now(), lastMove = this.lastMouseMove!\n    if (now - lastMove.timeStamp < HoverTime) {\n      this.hoverTimeout = setTimeout(this.checkHover, HoverTime - (now - lastMove.timeStamp))\n      return\n    }\n\n    let pos = this.view.contentDOM.contains(lastMove.target as HTMLElement)\n      ? this.view.posAtCoords({x: lastMove.clientX, y: lastMove.clientY}) : -1\n    let open = pos < 0 ? null : this.source(this.view, (from, to) => {\n      return from <= pos && to >= pos && (from == to || isOverRange(this.view, from, to, lastMove.clientX, lastMove.clientY))\n    })\n    if (open) this.view.dispatch(this.view.state.t().annotate(this.setHover, open))\n  }\n\n  mousemove(event: MouseEvent) {\n    this.lastMouseMove = event\n    if (this.hoverTimeout < 0) this.hoverTimeout = setTimeout(this.checkHover, HoverTime)\n    let active = this.active\n    if (active && !isInTooltip(event.target as HTMLElement) &&\n        (active.start == active.end\n         ? this.view.posAtCoords({x: event.clientX, y: event.clientY}) != active.start\n         : !isOverRange(this.view, active.start, active.end, event.clientX, event.clientY, HoverMaxDist)))\n      this.view.dispatch(this.view.state.t().annotate(this.setHover, null))\n  }\n\n  mouseenter() {\n    this.mouseInside = true\n  }\n\n  mouseleave() {\n    this.mouseInside = false\n    if (this.active)\n      this.view.dispatch(this.view.state.t().annotate(this.setHover, null))\n  }\n\n  destroy() {\n    this.view.dom.removeEventListener(\"mouseenter\", this.mouseenter.bind(this))\n    this.view.dom.removeEventListener(\"mouseleave\", this.mouseleave.bind(this))\n    this.view.dom.removeEventListener(\"mousemove\", this.mousemove.bind(this))\n  }\n}\n\nfunction isInTooltip(elt: HTMLElement) {\n  for (let cur: Node | null = elt; cur; cur = cur.parentNode)\n    if (cur.nodeType == 1 && (cur as HTMLElement).classList.contains(\"cm-tooltip\")) return true\n  return false\n}\n\nfunction isOverRange(view: EditorView, from: number, to: number, x: number, y: number, margin = 0) {\n  let range = document.createRange()\n  let fromDOM = view.domAtPos(from), toDOM = view.domAtPos(to)\n  range.setEnd(toDOM.node, toDOM.offset)\n  range.setStart(fromDOM.node, fromDOM.offset)\n  let rects = range.getClientRects()\n  for (let i = 0; i < rects.length; i++) {\n    let rect = rects[i]\n    let dist = Math.max(rect.top - y, y - rect.bottom, rect.left - x, x - rect.right)\n    if (dist <= margin) return true\n  }\n  return false\n}\n\n/// Enable a hover tooltip, which shows up when the pointer hovers\n/// over ranges of text. The callback should, for each hoverable\n/// range, call its `check` argument to see if that range is being\n/// hovered over, and return a tooltip description when it is.\nexport function hoverTooltip(\n  source: (view: EditorView, check: (from: number, to: number) => boolean) => HoverTooltip | null,\n  options: {hideOnChange?: boolean} = {}\n): Extension {\n  const setHover = Annotation.define<HoverTooltip | null>()\n  const hoverState = StateField.define<HoverTooltip | null>({\n    create() { return null },\n\n    update(value, tr) {\n      if (value && options.hideOnChange && (tr.docChanged || tr.selectionSet)) return null\n      let set = tr.annotation(setHover)\n      return set === undefined ? value : set\n    }\n  }).provideN(showTooltip, v => v ? [v.tooltip] : [])\n\n  return [\n    hoverState,\n    ViewPlugin.define(view => new HoverPlugin(view, source, hoverState, setHover)),\n    tooltips()\n  ]\n}\n"],"names":[],"mappings":"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"}